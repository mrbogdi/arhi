<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORE-ARCH OS v5.2 | High-Precision Engineering</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; color: #f8fafc; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); }
        .neo-accent { border-left: 4px solid #6366f1; }
        input { background: rgba(15, 23, 42, 0.5) !important; color: #60a5fa !important; border: 1px solid #334155 !important; }
        .status-badge { font-size: 9px; font-weight: 800; padding: 2px 8px; border-radius: 4px; text-transform: uppercase; }
    </style>
</head>
<body class="min-h-screen">

    <nav class="fixed top-0 w-full z-50 p-6">
        <div class="max-w-[1850px] mx-auto flex justify-between items-center glass rounded-2xl px-8 py-4 shadow-2xl">
            <div class="flex items-center gap-4">
                <div class="bg-indigo-600 p-2 rounded-lg"><i data-lucide="shield-check"></i></div>
                <div>
                    <h1 class="text-xl font-black tracking-tighter">CORE-ARCH <span class="text-indigo-500">v5.2</span></h1>
                    <p class="text-[8px] font-bold text-slate-400 tracking-[0.3em] uppercase">High Precision Calculus Engine</p>
                </div>
            </div>
            <div class="flex gap-6 items-center">
                <div class="text-right hidden md:block">
                    <p class="text-[9px] font-bold text-indigo-400">NORMATIV REF:</p>
                    <p class="text-[10px] font-mono">NE 012-1:2007 | SR EN 1992</p>
                </div>
                <button onclick="exportToPDF()" class="bg-indigo-600 hover:bg-white hover:text-indigo-900 transition-all px-6 py-2 rounded-xl text-xs font-black uppercase">Export PDF Tehnic</button>
            </div>
        </div>
    </nav>

    <div class="max-w-[1850px] mx-auto pt-32 px-6 pb-12 grid grid-cols-12 gap-8">
        
        <aside class="col-span-12 lg:col-span-3 space-y-4">
            <div class="glass p-6 rounded-3xl">
                <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">Sisteme de Calcul</h3>
                <div id="module-menu" class="space-y-2">
                    </div>
            </div>
            
            <div class="glass p-6 rounded-3xl border border-indigo-500/20">
                <h3 class="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-4">Monitorizare Live</h3>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] opacity-60">CPU Load</span>
                        <span class="text-[10px] font-mono text-emerald-400">12%</span>
                    </div>
                    <div class="w-full bg-slate-800 h-1 rounded-full"><div class="bg-indigo-500 w-[12%] h-full"></div></div>
                </div>
            </div>
        </aside>

        <main class="col-span-12 lg:col-span-6 space-y-6">
            <div class="glass p-2 rounded-[2.5rem] relative overflow-hidden h-[350px]">
                <div id="three-container" class="w-full h-full rounded-[2rem] overflow-hidden"></div>
                <div class="absolute bottom-6 left-6 flex gap-2">
                    <div class="glass px-4 py-2 rounded-lg text-[10px] font-bold flex items-center gap-2">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></span> VISUAL_CORE ACTIVE
                    </div>
                </div>
            </div>

            <div id="calc-workspace" class="glass p-10 rounded-[2.5rem] min-h-[500px]">
                <div id="empty-prompt" class="text-center py-20">
                    <i data-lucide="component" class="w-16 h-16 text-slate-700 mx-auto mb-6"></i>
                    <h2 class="text-2xl font-black text-slate-400">Sistem Ready</h2>
                    <p class="text-slate-500 text-sm">Selectați un modul pentru a iniția calculul de precizie.</p>
                </div>
            </div>
        </main>

        <aside class="col-span-12 lg:col-span-3 space-y-6">
            <div class="glass p-8 rounded-[2.5rem] neo-accent">
                <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">Sumar Resurse (Detaliat)</h3>
                <div id="resource-summary" class="space-y-4">
                    <p class="text-[10px] text-slate-500 italic">Așteptare date intrare...</p>
                </div>
            </div>

            <div class="glass p-8 rounded-[2.5rem]">
                <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Validare Proiect</h3>
                <div id="validation-panel" class="space-y-3">
                    <div class="flex items-center gap-3 opacity-30">
                        <i data-lucide="check-circle-2" class="text-emerald-500 w-4 h-4"></i>
                        <span class="text-[10px] font-bold">Verificare Eurocod 2</span>
                    </div>
                    <div class="flex items-center gap-3 opacity-30">
                        <i data-lucide="check-circle-2" class="text-emerald-500 w-4 h-4"></i>
                        <span class="text-[10px] font-bold">Calcul Pierderi Tehnologice</span>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <script>
        // --- DATA ENGINE: DEFINIȚII PRECISE ---
        const CONCRETE_RECIPES = {
            'C12/15': { cement: 290, sand: 780, gravel: 1150, water: 175, density: 2395 },
            'C16/20': { cement: 330, sand: 750, gravel: 1180, water: 185, density: 2445 },
            'C20/25': { cement: 360, sand: 720, gravel: 1210, water: 190, density: 2480 },
            'C25/30': { cement: 400, sand: 700, gravel: 1230, water: 200, density: 2530 }
        };

        const BRICK_TYPES = {
            'GVP_M': { name: "Cărămidă GVP (290x240x188)", l: 0.29, w: 0.24, h: 0.188, mortar: 0.012 },
            'BCA_M': { name: "BCA (600x250x200)", l: 0.6, w: 0.2, h: 0.25, mortar: 0.003 }
        };

        const engineModules = [
            {
                id: 'prec-concrete',
                name: 'Beton NE 012 (Fracții Agregate)',
                icon: 'anvil',
                inputs: [
                    { id: 'type', label: 'Clasă Beton', type: 'select', options: ['C12/15', 'C16/20', 'C20/25', 'C25/30'] },
                    { id: 'L', label: 'Lungime (m)', type: 'number', val: 10 },
                    { id: 'l', label: 'Lățime (m)', type: 'number', val: 0.25 },
                    { id: 'h', label: 'Înălțime (m)', type: 'number', val: 0.5 },
                    { id: 'waste', label: 'Pierderi Tehnologice (%)', type: 'number', val: 5 }
                ]
            },
            {
                id: 'prec-rebar',
                name: 'Armătură (Suprapuneri/Pierderi)',
                icon: 'list-ordered',
                inputs: [
                    { id: 'diam', label: 'Diametru Bara (mm)', type: 'number', val: 12 },
                    { id: 'qty', label: 'Nr. Bare', type: 'number', val: 8 },
                    { id: 'len', label: 'Lungime Bara (m)', type: 'number', val: 12 },
                    { id: 'overlap', label: 'Lungime Suprapunere (m)', type: 'number', val: 0.6 },
                    { id: 'overlap_qty', label: 'Nr. Suprapuneri', type: 'number', val: 1 }
                ]
            },
            {
                id: 'prec-masonry',
                name: 'Zidărie (Bucăți + Mortar)',
                icon: 'layout-grid',
                inputs: [
                    { id: 'm_type', label: 'Tip Bloc', type: 'select', options: ['GVP_M', 'BCA_M'] },
                    { id: 'w_len', label: 'Lungime Perete (m)', type: 'number', val: 15 },
                    { id: 'w_h', label: 'Înălțime Perete (m)', type: 'number', val: 2.8 }
                ]
            }
        ];

        let activeId = null;
        let scene, camera, renderer, model;

        // --- CORE LOGIC ---
        function init() {
            renderMenu();
            init3D();
            lucide.createIcons();
        }

        function renderMenu() {
            const container = document.getElementById('module-menu');
            engineModules.forEach(mod => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-4 rounded-xl hover:bg-indigo-600/20 transition-all flex items-center gap-4 group border border-transparent hover:border-indigo-500/30";
                btn.onclick = () => loadModule(mod.id);
                btn.innerHTML = `
                    <div class="p-2 bg-slate-800 rounded-lg group-hover:text-indigo-400"><i data-lucide="${mod.icon}" class="w-4 h-4"></i></div>
                    <span class="text-xs font-bold opacity-80">${mod.name}</span>
                `;
                container.appendChild(btn);
            });
        }

        function loadModule(id) {
            activeId = id;
            const mod = engineModules.find(m => m.id === id);
            const container = document.getElementById('calc-workspace');
            
            document.getElementById('empty-prompt').classList.add('hidden');
            document.querySelectorAll('#validation-panel > div').forEach(el => el.classList.remove('opacity-30'));

            container.innerHTML = `
                <div class="animate-in fade-in slide-in-from-bottom-6 duration-500">
                    <h2 class="text-3xl font-black mb-8 italic tracking-tighter">${mod.name}</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="space-y-6">
                            ${mod.inputs.map(inp => `
                                <div>
                                    <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest ml-1">${inp.label}</label>
                                    ${inp.type === 'select' ? 
                                        `<select id="f-${inp.id}" onchange="runCalculus()" class="w-full p-4 rounded-xl border-none outline-none font-bold text-indigo-400 mt-1 glass">
                                            ${inp.options.map(o => `<option value="${o}">${o}</option>`).join('')}
                                        </select>` :
                                        `<input type="number" id="f-${inp.id}" value="${inp.val}" oninput="runCalculus()" class="w-full p-4 rounded-xl outline-none font-bold mt-1">`
                                    }
                                </div>
                            `).join('')}
                        </div>
                        <div class="bg-indigo-600/10 rounded-[2rem] p-10 border border-indigo-500/20 flex flex-col justify-center">
                            <span class="text-[10px] font-black text-indigo-400 uppercase tracking-widest mb-2">Rezultat Principal</span>
                            <div class="flex items-baseline gap-3">
                                <span id="main-res" class="text-7xl font-black text-white">0.00</span>
                                <span id="main-unit" class="text-lg font-bold text-indigo-400 uppercase">Unit</span>
                            </div>
                            <div id="sub-res" class="mt-8 pt-8 border-t border-indigo-500/20 text-[10px] font-mono leading-relaxed text-slate-400">
                                SYSTEM_STATUS: Awaiting input...
                            </div>
                        </div>
                    </div>
                </div>
            `;
            runCalculus();
            lucide.createIcons();
        }

        function runCalculus() {
            if (!activeId) return;
            const resSummary = document.getElementById('resource-summary');
            resSummary.innerHTML = '';
            
            if (activeId === 'prec-concrete') {
                const type = document.getElementById('f-type').value;
                const L = parseFloat(document.getElementById('f-L').value) || 0;
                const l = parseFloat(document.getElementById('f-l').value) || 0;
                const h = parseFloat(document.getElementById('f-h').value) || 0;
                const waste = parseFloat(document.getElementById('f-waste').value) || 0;

                const netVol = L * l * h;
                const grossVol = netVol * (1 + waste / 100);
                const recipe = CONCRETE_RECIPES[type];

                document.getElementById('main-res').innerText = grossVol.toFixed(3);
                document.getElementById('main-unit').innerText = 'm³';
                document.getElementById('sub-res').innerText = `CALC: ${L}x${l}x${h} | VOL_NET: ${netVol.toFixed(3)} | PIERDERI: ${waste}%`;

                addResource('Ciment CEM I 42.5', (grossVol * recipe.cement).toFixed(0), 'kg');
                addResource('Nisip (0-4mm)', (grossVol * recipe.sand).toFixed(0), 'kg');
                addResource('Pietriș (4-16mm)', (grossVol * recipe.gravel).toFixed(0), 'kg');
                addResource('Apă', (grossVol * recipe.water).toFixed(0), 'litri');

                update3D('box', [L, h, l]);
            }

            else if (activeId === 'prec-rebar') {
                const d = parseFloat(document.getElementById('f-diam').value) || 0;
                const qty = parseFloat(document.getElementById('f-qty').value) || 0;
                const len = parseFloat(document.getElementById('f-len').value) || 0;
                const overlap = parseFloat(document.getElementById('f-overlap').value) || 0;
                const ovQty = parseFloat(document.getElementById('f-overlap_qty').value) || 0;

                const totalLen = (len + (overlap * ovQty)) * qty;
                const weightPerM = (d * d) / 162.2;
                const totalWeight = totalLen * weightPerM;

                document.getElementById('main-res').innerText = totalWeight.toFixed(2);
                document.getElementById('main-unit').innerText = 'kg';
                document.getElementById('sub-res').innerText = `DENS: ${weightPerM.toFixed(3)}kg/m | L_TOT: ${totalLen.toFixed(2)}m`;

                addResource('Fier BST500', totalWeight.toFixed(2), 'kg');
                addResource('Bare întregi (12m)', Math.ceil(totalLen / 12), 'buc');
                
                update3D('cylinder', [d/50, len, d/50]);
            }

            else if (activeId === 'prec-masonry') {
                const type = document.getElementById('f-m_type').value;
                const L = parseFloat(document.getElementById('f-w_len').value) || 0;
                const H = parseFloat(document.getElementById('f-w_h').value) || 0;
                
                const brick = BRICK_TYPES[type];
                const area = L * H;
                
                // Calcul precis bucati per m2 (cu rost)
                const pcsPerM2 = 1 / ((brick.l + brick.mortar) * (brick.h + brick.mortar));
                const totalPcs = area * pcsPerM2;
                const totalMortar = area * brick.w * brick.mortar * 5; // Estimare rosturi orizontale/verticale

                document.getElementById('main-res').innerText = Math.ceil(totalPcs);
                document.getElementById('main-unit').innerText = 'Bucăți';
                document.getElementById('sub-res').innerText = `SUPRAF: ${area.toFixed(2)}mp | CONS_SPEC: ${pcsPerM2.toFixed(1)}buc/mp`;

                addResource('Blocuri Zidărie', Math.ceil(totalPcs), 'buc');
                addResource('Mortar M5', totalMortar.toFixed(3), 'm³');
                addResource('Paleți Estimati', Math.ceil(totalPcs / 60), 'buc');

                update3D('box', [L, H, brick.w * 5]);
            }
        }

        function addResource(label, val, unit) {
            const container = document.getElementById('resource-summary');
            const div = document.createElement('div');
            div.className = "flex justify-between items-center p-4 bg-white/5 rounded-xl border border-white/5";
            div.innerHTML = `
                <span class="text-[9px] font-black text-slate-500 uppercase">${label}</span>
                <span class="text-xs font-mono font-bold text-indigo-400">${val} <span class="opacity-50 text-[8px]">${unit}</span></span>
            `;
            container.appendChild(div);
        }

        // --- 3D ENGINE ---
        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, preserveDrawingBuffer: true });
            
            const container = document.getElementById('three-container');
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            camera.position.set(10, 10, 10);
            camera.lookAt(0, 0, 0);

            const light = new THREE.DirectionalLight(0x6366f1, 2);
            light.position.set(5, 5, 5);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0x475569, 1));

            animate();
        }

        function update3D(type, dims) {
            if (model) scene.remove(model);
            let geo;
            if (type === 'box') geo = new THREE.BoxGeometry(dims[0]/2, dims[1], dims[2]/2);
            else if (type === 'cylinder') geo = new THREE.CylinderGeometry(dims[0], dims[0], dims[1]/2, 32);
            
            const mat = new THREE.MeshStandardMaterial({ color: 0x6366f1, wireframe: true });
            model = new THREE.Mesh(geo, mat);
            scene.add(model);
        }

        function animate() {
            requestAnimationFrame(animate);
            if (model) model.rotation.y += 0.01;
            renderer.render(scene, camera);
        }

        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFillColor(15, 23, 42);
            doc.rect(0, 0, 210, 297, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.text("MEMORIU TEHNIC DE CALCUL", 20, 30);
            
            doc.setFontSize(10);
            doc.setTextColor(99, 102, 241);
            doc.text(`PROIECT: SKY-CORE SENTINEL | MODUL: ${activeId.toUpperCase()}`, 20, 40);

            const canvas = document.querySelector('canvas');
            const imgData = canvas.toDataURL('image/png');
            doc.addImage(imgData, 'PNG', 20, 50, 170, 80);

            doc.setTextColor(255, 255, 255);
            doc.text("SUMAR RESURSE CALCULATE:", 20, 145);
            
            let y = 155;
            document.querySelectorAll('#resource-summary > div').forEach(el => {
                doc.text(el.innerText, 25, y);
                y += 8;
            });

            doc.setFontSize(8);
            doc.text("Acest document este generat automat si respecta normativele NE 012-1:2007.", 20, 280);
            doc.save(`Raport_Inginerie_${Date.now()}.pdf`);
        }

        init();
    </script>
</body>
</html>
