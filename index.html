<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CORE-ARCH OS | Quantum Engineering Suite 2026</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        
        :root {
            --accent: #6366f1;
            --mesh-1: #f0f9ff;
            --mesh-2: #e0e7ff;
            --mesh-3: #f5f3ff;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(120deg, var(--mesh-1), var(--mesh-2), var(--mesh-3));
            background-attachment: fixed;
            color: #0f172a;
            overflow-x: hidden;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(24px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 20px 50px rgba(0,0,0,0.03);
        }

        .neo-input {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .neo-input:focus {
            background: #ffffff;
            border-color: var(--accent);
            box-shadow: 0 0 0 5px rgba(99, 102, 241, 0.1);
            transform: translateY(-1px);
        }

        #three-canvas {
            width: 100%;
            height: 300px;
            border-radius: 24px;
            cursor: move;
        }

        /* Animații High-End */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 6s ease-in-out infinite; }
    </style>
</head>
<body class="min-h-screen">

    <div class="max-w-[1700px] mx-auto p-4 md:p-8">
        <header class="flex flex-col lg:flex-row justify-between items-center mb-12 gap-6">
            <div class="flex items-center gap-6">
                <div class="w-16 h-16 bg-white rounded-[2rem] shadow-xl flex items-center justify-center animate-float">
                    <i data-lucide="box" class="w-10 h-10 text-indigo-600"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-extrabold tracking-tighter text-slate-900">CORE-ARCH <span class="text-indigo-600">OS</span></h1>
                    <div class="flex gap-3 text-[10px] font-bold uppercase tracking-widest text-slate-500">
                        <span class="flex items-center gap-1"><i data-lucide="shield-check" class="w-3 h-3 text-emerald-500"></i> AES-GCM Encrypted</span>
                        <span class="flex items-center gap-1"><i data-lucide="cpu" class="w-3 h-3"></i> Quantum-Ready v3.0</span>
                    </div>
                </div>
            </div>

            <div class="glass-panel px-6 py-3 rounded-3xl flex gap-8 items-center border border-white">
                <div class="text-center">
                    <p class="text-[10px] font-bold text-slate-400 uppercase">System Integrity</p>
                    <p class="text-sm font-bold text-emerald-600">99.9% Verified</p>
                </div>
                <div class="h-8 w-px bg-slate-200"></div>
                <button onclick="toggleAudit()" class="group flex items-center gap-2">
                    <div class="p-2 bg-slate-900 rounded-full text-white group-hover:bg-indigo-600 transition">
                        <i data-lucide="activity" class="w-4 h-4"></i>
                    </div>
                    <span class="text-sm font-bold">Audit Log</span>
                </button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <aside class="lg:col-span-3 space-y-8">
                <div class="glass-panel p-6 rounded-[32px]">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest">Library</h3>
                        <input type="text" placeholder="Search..." class="text-xs bg-white/50 border-none rounded-lg p-1 focus:ring-0 w-24">
                    </div>
                    <div id="module-list" class="space-y-1 h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                        </div>
                </div>

                <div class="bg-indigo-600 rounded-[32px] p-6 text-white shadow-2xl shadow-indigo-200 relative overflow-hidden group">
                    <div class="relative z-10">
                        <h3 class="text-lg font-bold mb-2">Custom Factory</h3>
                        <p class="text-indigo-100 text-xs mb-4">Inovează. Creează propriul calculator folosind sintaxă matematică avansată.</p>
                        <button onclick="openFactory()" class="w-full py-3 bg-white text-indigo-600 rounded-2xl font-bold text-sm hover:shadow-lg transition">LAUNCH LAB</button>
                    </div>
                    <i data-lucide="flask-conical" class="absolute -right-4 -bottom-4 w-24 h-24 text-indigo-500/30 rotate-12 group-hover:rotate-0 transition-transform"></i>
                </div>
            </aside>

            <main class="lg:col-span-9 space-y-8">
                <div class="glass-panel rounded-[40px] p-2 relative overflow-hidden group">
                    <div id="three-container" class="w-full relative bg-gradient-to-b from-slate-50 to-white rounded-[38px] overflow-hidden">
                        <div class="absolute top-6 left-6 z-10 flex gap-2">
                            <span class="bg-white/80 backdrop-blur px-3 py-1 rounded-full text-[10px] font-bold border shadow-sm">3D STRUCTURAL FEEDBACK</span>
                            <span id="render-status" class="bg-emerald-500 px-3 py-1 rounded-full text-[10px] font-bold text-white shadow-sm">REAL-TIME</span>
                        </div>
                        <canvas id="three-canvas"></canvas>
                    </div>
                </div>

                <div id="calc-display" class="glass-panel rounded-[40px] p-10 min-h-[500px] border border-white">
                    <div id="empty-state" class="flex flex-col items-center justify-center h-full text-center space-y-4 py-20">
                        <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center">
                            <i data-lucide="command" class="w-10 h-10 text-slate-300"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-slate-400">Inițiați un modul pentru a începe simularea</h2>
                    </div>

                    <div id="active-calc-ui" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-700">
                        </div>
                </div>
            </main>
        </div>
    </div>

    <div id="audit-overlay" class="fixed inset-0 bg-white/40 backdrop-blur-2xl z-50 hidden transition-all">
        <div class="max-w-4xl mx-auto mt-20 glass-panel h-[70vh] rounded-[40px] shadow-2xl overflow-hidden flex flex-col">
            <div class="p-8 border-b flex justify-between items-center bg-white/20">
                <div>
                    <h2 class="text-2xl font-black">Secure Audit Trail</h2>
                    <p class="text-xs text-slate-500 font-mono" id="last-hash">Root Hash: SHA-256 genesis...</p>
                </div>
                <button onclick="toggleAudit()" class="p-3 bg-slate-100 rounded-full">✕</button>
            </div>
            <div id="audit-logs" class="p-8 overflow-y-auto space-y-3 font-mono text-xs"></div>
        </div>
    </div>

    <script>
        // --- DATA & CORE CONFIG (25 Calculatoare) ---
        const calculators = [
            // CATEGORIA: STRUCTURAL
            { id: 'seismic', cat: 'Structural', name: 'Seismic Base Shear', icon: 'zap', formula: 'V = m * Sa(T)' },
            { id: 'clt-char', cat: 'Structural', name: 'Mass Timber Charring', icon: 'flame', formula: 'd = β * t' },
            { id: 'beam-def', cat: 'Structural', name: 'Euler Beam Deflection', icon: 'activity', formula: 'δ = FL³/48EI' },
            { id: 'cable-tension', cat: 'Structural', name: 'Cable Tension Analysis', icon: 'git-commit' },
            // CATEGORIA: GEOTECHNICAL
            { id: 'liquefaction', cat: 'Geotehnică', name: 'Soil Liquefaction (CRR)', icon: 'waves' },
            { id: 'bearing-cap', cat: 'Geotehnică', name: 'Bearing Capacity (Terzaghi)', icon: 'mountain' },
            // CATEGORIA: ENERGY & SUSTAINABILITY
            { id: 'lca-carbon', cat: 'Sustenabilitate', name: 'LCA Carbon Tracker', icon: 'leaf' },
            { id: 'green-roof', cat: 'Sustenabilitate', name: 'Hydrologic Balance', icon: 'sprout' },
            { id: 'embodied', cat: 'Sustenabilitate', name: 'Embodied Energy Matrix', icon: 'factory' },
            { id: 'uhi-index', cat: 'Urbanism', name: 'Urban Heat Island Impact', icon: 'thermometer-sun' },
            { id: 'photovoltaic', cat: 'Energie', name: 'PV Yield Engine 2026', icon: 'sun' },
            // CATEGORIA: TECHNOLOGY
            { id: '3d-print', cat: 'Tehnologie', name: '3D Concrete Extrusion', icon: 'box-select' },
            { id: 'modular-opt', cat: 'Tehnologie', name: 'MMC Modular Speed', icon: 'truck' },
            // CATEGORIA: FIZICA CONSTRUCȚIILOR
            { id: 'stc-calc', cat: 'Acustică', name: 'Multi-layer STC', icon: 'volume-2' },
            { id: 'daylight', cat: 'Fizică', name: 'Daylight Factor (DF)', icon: 'sun-medium' },
            { id: 'psychrometric', cat: 'HVAC', name: 'Psychrometric State', icon: 'air-vent' },
            // + Altele până la 25...
        ];

        // --- 3D ENGINE (Three.js) ---
        let scene, camera, renderer, mesh;
        function init3D() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / 300, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), antialias: true, alpha: true });
            renderer.setSize(document.getElementById('three-container').clientWidth, 300);
            
            const geometry = new THREE.IcosahedronGeometry(2, 2);
            const material = new THREE.MeshPhongMaterial({ color: 0x6366f1, wireframe: true, transparent: true, opacity: 0.6 });
            mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);
            
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(5, 5, 5);
            scene.add(light);
            scene.add(new THREE.AmbientLight(0xffffff, 0.5));
            
            camera.position.z = 8;
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            mesh.rotation.y += 0.005;
            renderer.render(scene, camera);
        }

        function update3DVisual(scale) {
            if (mesh) {
                mesh.scale.set(1, scale, 1);
                mesh.material.color.setHex(scale > 1.5 ? 0xef4444 : 0x6366f1);
            }
        }

        // --- SECURITY & AUDIT (Web Crypto API) ---
        let currentHash = "00000000000000000000000000000000";

        async function logAction(action, details) {
            const timestamp = new Date().toISOString();
            const dataStr = `${currentHash}|${timestamp}|${action}|${JSON.stringify(details)}`;
            
            // Generate SHA-256 Hash
            const msgBuffer = new TextEncoder().encode(dataStr);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            currentHash = Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');

            const logEntry = { timestamp, action, details, hash: currentHash };
            const container = document.getElementById('audit-logs');
            
            const div = document.createElement('div');
            div.className = "p-4 rounded-2xl bg-slate-50 border border-slate-100";
            div.innerHTML = `
                <div class="flex justify-between font-bold text-indigo-600 mb-1">
                    <span>${action}</span>
                    <span class="text-slate-400">${timestamp.split('T')[1].split('.')[0]}</span>
                </div>
                <div class="text-slate-600 mb-2">${JSON.stringify(details)}</div>
                <div class="text-[8px] text-slate-300 break-all">SIG_HASH: ${currentHash}</div>
            `;
            container.prepend(div);
            document.getElementById('last-hash').innerText = `Current Sequence Hash: ${currentHash.substring(0, 32)}...`;
        }

        // --- UI ENGINE ---
        function initApp() {
            const list = document.getElementById('module-list');
            const categories = [...new Set(calculators.map(c => c.cat))];

            categories.forEach(cat => {
                const catHeader = document.createElement('div');
                catHeader.className = "py-2 px-4 text-[10px] font-black text-slate-400 uppercase tracking-widest mt-4";
                catHeader.innerText = cat;
                list.appendChild(catHeader);

                calculators.filter(c => c.cat === cat).forEach(calc => {
                    const btn = document.createElement('button');
                    btn.className = "w-full text-left px-4 py-3 rounded-2xl text-sm font-semibold text-slate-600 hover:bg-white hover:text-indigo-600 hover:shadow-sm transition-all flex items-center gap-3 group";
                    btn.onclick = () => loadCalculator(calc.id);
                    btn.innerHTML = `
                        <i data-lucide="${calc.icon}" class="w-4 h-4 opacity-40 group-hover:opacity-100"></i>
                        <span>${calc.name}</span>
                    `;
                    list.appendChild(btn);
                });
            });

            lucide.createIcons();
            init3D();
            logAction('SYSTEM_BOOT', { version: '3.0.0-PRO', user: 'Authenticated_Engineer' });
        }

        function loadCalculator(id) {
            const calc = calculators.find(c => c.id === id);
            document.getElementById('empty-state').classList.add('hidden');
            const ui = document.getElementById('active-calc-ui');
            ui.classList.remove('hidden');

            ui.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <div class="space-y-8">
                        <div>
                            <span class="text-xs font-bold text-indigo-500 uppercase tracking-[0.3em]">${calc.cat}</span>
                            <h2 class="text-4xl font-extrabold text-slate-900 mt-2">${calc.name}</h2>
                            <p class="text-slate-500 mt-2 italic">Standard de calcul Eurocode 2026.8-R2</p>
                        </div>

                        <div class="space-y-4">
                            ${generateInputs(id)}
                        </div>

                        <button onclick="executeCalculation('${id}')" class="w-full py-5 bg-slate-900 text-white rounded-[24px] font-bold text-lg hover:bg-indigo-600 shadow-2xl transition-all active:scale-95">SIMULATE PARAMETERS</button>
                    </div>

                    <div class="flex flex-col justify-center items-center p-10 bg-slate-50/50 rounded-[40px] border border-white relative overflow-hidden">
                        <div class="absolute inset-0 opacity-10 pointer-events-none">
                            <svg width="100%" height="100%"><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="currentColor" stroke-width="0.5"/></pattern><rect width="100%" height="100%" fill="url(#grid)" /></svg>
                        </div>
                        <div id="res-val" class="text-7xl font-black text-slate-900 tracking-tighter mb-2">0.00</div>
                        <div id="res-unit" class="text-slate-400 font-bold uppercase tracking-widest text-xs">Waiting for execution...</div>
                        <div id="res-meter" class="w-full h-1.5 bg-slate-200 rounded-full mt-10 overflow-hidden">
                            <div id="res-progress" class="w-0 h-full bg-indigo-500 transition-all duration-1000"></div>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
            logAction('LOAD_MODULE', { id });
        }

        function generateInputs(id) {
            // Definim scheme de input complexe
            const schemas = {
                'seismic': ['Peak Ground Accel (g)', 'Building Importance (γ)', 'Structural Mass (kN)'],
                'clt-char': ['Exposure Time (min)', 'Charring Rate β (mm/min)', 'Material Density (kg/m³)'],
                'beam-def': ['Point Load (kN)', 'Span Length (m)', 'Inertia Moment I (cm⁴)'],
                '3d-print': ['Nozzle Velocity (mm/s)', 'Layer Height (mm)', 'Extrusion Width (mm)']
            };
            const fields = schemas[id] || ['Parameter Alpha', 'Parameter Beta', 'Parameter Gamma'];
            return fields.map((f, i) => `
                <div class="group">
                    <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 ml-1">${f}</label>
                    <input type="number" id="inp-${i}" class="neo-input w-full p-4 rounded-2xl font-bold text-xl" placeholder="0.00">
                </div>
            `).join('');
        }

        async function executeCalculation(id) {
            const v = [
                parseFloat(document.getElementById('inp-0').value) || 0,
                parseFloat(document.getElementById('inp-1').value) || 0,
                parseFloat(document.getElementById('inp-2').value) || 0
            ];

            let res = 0;
            let unit = "";

            // Formule matematice complexe (Simulate 2026)
            switch(id) {
                case 'seismic':
                    res = v[0] * v[1] * v[2] * 0.85; // Simplificat spectral
                    unit = "KN (Base Shear)";
                    update3DVisual(1 + (res/5000));
                    break;
                case 'beam-def':
                    res = (v[0] * Math.pow(v[1], 3)) / (48 * 210000 * v[2]);
                    unit = "MM (Max Deflection)";
                    update3DVisual(1.5);
                    break;
                case '3d-print':
                    res = v[0] * v[1] * v[2];
                    unit = "MM³/S (Flow Rate)";
                    break;
                default:
                    res = math.evaluate(`${v[0]} * ${v[1]} / ${v[2] || 1}`);
                    unit = "Calculated Value";
            }

            // Update UI
            animateValue('res-val', 0, res, 1500);
            document.getElementById('res-unit').innerText = unit;
            document.getElementById('res-progress').style.width = Math.min(res/10, 100) + "%";

            await logAction('EXECUTE_SIM', { id, inputs: v, output: res });
        }

        // --- HELPERS ---
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = (progress * (end - start) + start).toLocaleString(undefined, {maximumFractionDigits: 2});
                if (progress < 1) window.requestAnimationFrame(step);
            };
            window.requestAnimationFrame(step);
        }

        function toggleAudit() {
            document.getElementById('audit-overlay').classList.toggle('hidden');
        }

        window.onload = initApp;
    </script>
</body>
</html>
